"""This file creates the control datasets and saves them as HDF files.

The data included in this file has been manually copied from TRAC's Immigration
tools. It is included here only for testing purposes and is not covered by the
License for the rest of this repository.
"""

import pandas as pd
from dataclasses import dataclass
from pathlib import Path
import os

@dataclass
class Dataset:
    filename: str
    data: dict
    axes: list[str]
    axes_order: list[int] | None = None
    df: pd.DataFrame | None = None
    optimized: bool = False

def clean_dataset(dataset):
    """Clean the raw collated dataset to ensure clarity and completeness."""
    # Ensure index and column order match what the user specified
    if dataset.optimized and dataset.axes_order != sorted(dataset.axes_order):
        dataset.df = dataset.df.stack()
        col_order_index = dataset.axes_order.index(max(dataset.axes_order))

        dataset.df = dataset.df.unstack(col_order_index)

        idx_order = [i for i in dataset.axes_order if i!=max(dataset.axes_order)]
        dataset.df = dataset.df.reorder_levels(idx_order)

    
    # Rectify missing second-level index entries
    unique_index1 = dataset.df.index.unique(0)
    unique_index2 = dataset.df.index.unique(1)
    new_index = pd.MultiIndex.from_product([unique_index1, unique_index2])
    dataset.df = dataset.df.reindex(new_index, axis='index')

    # Change all NaN values to 0
    dataset.df = dataset.df.fillna(value=0.0)

    # Sort df rows
    dataset.df = dataset.df.sort_index()

    # Sort df columns
    dataset.df = dataset.df.reindex(sorted(dataset.df.columns), axis=1)

    # Add a Total Column
    dataset.df['Total'] = dataset.df.sum(axis=1)

    # Convert all floats to int (cannot have fractions of people)
    float_cols = dataset.df.select_dtypes(include=['float64'])
    for col in float_cols.columns.values:
        dataset.df[col] = dataset.df[col].astype('int64')

    # Rename indices to reflect axis names
    for i, a in enumerate(dataset.axes[:-1]):
        dataset.df.index.rename(names=a, level=i, inplace=True)
    
    # Rename columns with the final axis
    dataset.df = dataset.df.rename_axis(columns=dataset.axes[-1])

def save_dataset(dataset):
    control_path = Path().cwd() / "control"

    if not control_path.exists():
        os.mkdir("control")

    dataset.df.to_hdf(f"control/{dataset.filename}", key="TRACDataset")

def create_raw_df(dataset):
    dataset.df = pd.DataFrame(dataset.data)

#  Dataset = namedtuple("Dataset", ["filename", "axes_in_order", "data", "df"])

datasets = [
    Dataset(
        filename="2025-02-25_AsylumDecisions_Decision-Age-Absentia.hdf",
        axes=["Decision", "Age", "Absentia"],
        axes_order=[0, 1, 2],
        data={
            "Other": {
                ("Asylum Relief Denied", "Unknown"): 259713,
                ("Asylum Relief Denied", "25-34"): 59190,
                ("Asylum Relief Denied", "35-44"): 33805,
                ("Asylum Relief Denied", "18-24"): 32736,
                ("Asylum Relief Denied", "05-11"): 27572,
                ("Asylum Relief Denied", "12-17"): 24188,
                ("Asylum Relief Denied", "0-4"): 23125,
                ("Asylum Relief Denied", "45-59"): 12866,
                ("Asylum Relief Denied", "60+"): 1185,
                ("Asylum Granted", "Unknown"): 236945,
                ("Asylum Granted", "25-34"): 35649,
                ("Asylum Granted", "35-44"): 21242,
                ("Asylum Granted", "18-24"): 19347,
                ("Asylum Granted", "05-11"): 15003,
                ("Asylum Granted", "0-4"): 11074,
                ("Asylum Granted", "12-17"): 10542,
                ("Asylum Granted", "45-59"): 7776,
                ("Asylum Granted", "60+"): 867,
                ("Other Relief Granted", "Unknown"): 10396,
                ("Other Relief Granted", "25-34"): 2897,
                ("Other Relief Granted", "35-44"): 1793,
                ("Other Relief Granted", "18-24"): 1583,
                ("Other Relief Granted", "12-17"): 771,
                ("Other Relief Granted", "45-59"): 733,
                ("Other Relief Granted", "05-11"): 608,
                ("Other Relief Granted", "0-4"): 466,
                ("Other Relief Granted", "60+"): 60,
            },
            "Absentia": {
                ("Asylum Relief Denied", "Unknown"): 9631,
                ("Asylum Relief Denied", "25-34"): 696,
                ("Asylum Relief Denied", "18-24"): 453,
                ("Asylum Relief Denied", "35-44"): 445,
                ("Asylum Relief Denied", "12-17"): 427,
                ("Asylum Relief Denied", "0-4"): 317,
                ("Asylum Relief Denied", "05-11"): 316,
                ("Asylum Relief Denied", "45-59"): 217,
                ("Asylum Relief Denied", "60+"): 29,
                ("Asylum Granted", "Unknown"): 161,
                ("Asylum Granted", "25-34"): 10,
                ("Asylum Granted", "18-24"): 6,
                ("Asylum Granted", "05-11"): 5,
                ("Asylum Granted", "12-17"): 4,
                ("Asylum Granted", "45-59"): 2,
                ("Asylum Granted", "35-44"): 1,
                ("Asylum Granted", "0-4"): 1,
                ("Other Relief Granted", "Unknown"): 65,
                ("Other Relief Granted", "25-34"): 3,
            }
        }
    ),
    Dataset(
        filename="2025-02-25_AsylumFilings_Custody-HowLongInUS-Gender.hdf",
        axes=["Custody", "How Long in U.S.", "Gender"],
        axes_order=[0, 1, 2],
        data={
            "Unknown": {
                ("Never Detained", "Up to 1 year"): 159974,
                ("Never Detained", "Not Known"): 157686,
                ("Never Detained", "Between 1 and 2 years"): 107267,
                ("Never Detained", "Between 10 and 15 years"): 60506,
                ("Never Detained", "Between 2 and 3 years"): 43308,
                ("Never Detained", "Between 15 and 20 years"): 32127,
                ("Never Detained", "Between 3 and 4 years"): 31697,
                ("Never Detained", "Between 4 and 5 years"): 18940,
                ("Never Detained", "Between 5 and 6 years"): 13664,
                ("Never Detained", "20 years or more"): 12925,
                ("Never Detained", "Between 6 and 7 years"): 11403,
                ("Never Detained", "Between 7 and 8 years"): 10116,
                ("Never Detained", "Between 8 and 9 years"): 8398,
                ("Never Detained", "Between 9 and 10 years"): 7606,
                ("Released", "Up to 1 year"): 87297,
                ("Released", "Not Known"): 45213,
                ("Released", "Between 1 and 2 years"): 28715,
                ("Released", "Between 2 and 3 years"): 11873,
                ("Released", "Between 3 and 4 years"): 6815,
                ("Released", "Between 4 and 5 years"): 4442,
                ("Released", "Between 10 and 15 years"): 3794,
                ("Released", "Between 5 and 6 years"): 3116,
                ("Released", "Between 15 and 20 years"): 2581,
                ("Released", "Between 6 and 7 years"): 2280,
                ("Released", "20 years or more"): 2130,
                ("Released", "Between 7 and 8 years"): 1769,
                ("Released", "Between 8 and 9 years"): 1445,
                ("Released", "Between 9 and 10 years"): 1099,
                ("Detained", "Up to 1 year"): 27578,
                ("Detained", "Not Known"): 24663,
                ("Detained", "20 years or more"): 4503,
                ("Detained", "Between 10 and 15 years"): 4206,
                ("Detained", "Between 15 and 20 years"): 3211,
                ("Detained", "Between 1 and 2 years"): 1901,
                ("Detained", "Between 2 and 3 years"): 1249,
                ("Detained", "Between 3 and 4 years"): 1154,
                ("Detained", "Between 4 and 5 years"): 1004,
                ("Detained", "Between 6 and 7 years"): 1003,
                ("Detained", "Between 5 and 6 years"): 978,
                ("Detained", "Between 7 and 8 years"): 926,
                ("Detained", "Between 8 and 9 years"): 917,
                ("Detained", "Between 9 and 10 years"): 912,
                ("Not Known", "Up to 1 year"): 32,
                ("Not Known", "Between 1 and 2 years"): 28,
                ("Not Known", "Not Known"): 25,
                ("Not Known", "Between 10 and 15 years"): 21,
                ("Not Known", "Between 2 and 3 years"): 7,
                ("Not Known", "Between 4 and 5 years"): 6,
                ("Not Known", "Between 3 and 4 years"): 5,
                ("Not Known", "Between 15 and 20 years"): 4,
                ("Not Known", "Between 6 and 7 years"): 4,
                ("Not Known", "Between 7 and 8 years"): 3,
                ("Not Known", "Between 5 and 6 years"): 2,
                ("Not Known", "Between 8 and 9 years"): 1,
                ("Not Known", "Between 9 and 10 years"): 1,
            },
            "Male": {
                ("Never Detained", "Up to 1 year"): 143039,
                ("Never Detained", "Not Known"): 79552,
                ("Never Detained", "Between 1 and 2 years"): 67624,
                ("Never Detained", "Between 2 and 3 years"): 28263,
                ("Never Detained", "Between 3 and 4 years"): 17250,
                ("Never Detained", "Between 4 and 5 years"): 7871,
                ("Never Detained", "Between 10 and 15 years"): 5366,
                ("Never Detained", "Between 15 and 20 years"): 5125,
                ("Never Detained", "Between 5 and 6 years"): 4791,
                ("Never Detained", "20 years or more"): 2765,
                ("Never Detained", "Between 6 and 7 years"): 2754,
                ("Never Detained", "Between 7 and 8 years"): 1816,
                ("Never Detained", "Between 8 and 9 years"): 1214,
                ("Never Detained", "Between 9 and 10 years"): 880,
                ("Released", "Up to 1 year"): 55775,
                ("Released", "Not Known"): 32914,
                ("Released", "Between 1 and 2 years"): 16454,
                ("Released", "Between 2 and 3 years"): 6463,
                ("Released", "Between 3 and 4 years"): 3450,
                ("Released", "Between 4 and 5 years"): 1741,
                ("Released", "Between 5 and 6 years"): 1245,
                ("Released", "Between 10 and 15 years"): 1144,
                ("Released", "20 years or more"): 828,
                ("Released", "Between 6 and 7 years"): 778,
                ("Released", "Between 15 and 20 years"): 700,
                ("Released", "Between 7 and 8 years"): 558,
                ("Released", "Between 8 and 9 years"): 435,
                ("Released", "Between 9 and 10 years"): 378,
                ("Detained", "Up to 1 year"): 19119,
                ("Detained", "Not Known"): 22947,
                ("Detained", "20 years or more"): 2462,
                ("Detained", "Between 10 and 15 years"): 1726,
                ("Detained", "Between 15 and 20 years"): 1445,
                ("Detained", "Between 1 and 2 years"): 1182,
                ("Detained", "Between 2 and 3 years"): 883,
                ("Detained", "Between 3 and 4 years"): 764,
                ("Detained", "Between 4 and 5 years"): 652,
                ("Detained", "Between 5 and 6 years"): 572,
                ("Detained", "Between 7 and 8 years"): 469,
                ("Detained", "Between 6 and 7 years"): 456,
                ("Detained", "Between 8 and 9 years"): 394,
                ("Detained", "Between 9 and 10 years"): 372,
                ("Not Known", "Between 1 and 2 years"): 8,
                ("Not Known", "Not Known"): 3,
                ("Not Known", "Up to 1 year"): 1,
                ("Not Known", "Between 4 and 5 years"): 1,
                ("Not Known", "Between 9 and 10 years"): 1,
            },
            "Female": {
                ("Never Detained", "Up to 1 year"): 166036,
                ("Never Detained", "Between 1 and 2 years"): 78013,
                ("Never Detained", "Not Known"): 77433,
                ("Never Detained", "Between 2 and 3 years"): 32154,
                ("Never Detained", "Between 3 and 4 years"): 18201,
                ("Never Detained", "Between 4 and 5 years"): 7944,
                ("Never Detained", "Between 10 and 15 years"): 5377,
                ("Never Detained", "Between 15 and 20 years"): 4764,
                ("Never Detained", "Between 5 and 6 years"): 4718,
                ("Never Detained", "Between 6 and 7 years"): 2630,
                ("Never Detained", "20 years or more"): 2152,
                ("Never Detained", "Between 7 and 8 years"): 1560,
                ("Never Detained", "Between 8 and 9 years"): 1032,
                ("Never Detained", "Between 9 and 10 years"): 694,
                ("Released", "Up to 1 year"): 23096,
                ("Released", "Between 1 and 2 years"): 8974,
                ("Released", "Not Known"): 8422,
                ("Released", "Between 2 and 3 years"): 3766,
                ("Released", "Between 3 and 4 years"): 1928,
                ("Released", "Between 4 and 5 years"): 906,
                ("Released", "Between 5 and 6 years"): 607,
                ("Released", "Between 6 and 7 years"): 281,
                ("Released", "Between 7 and 8 years"): 187,
                ("Released", "Between 10 and 15 years"): 178,
                ("Released", "Between 15 and 20 years"): 113,
                ("Released", "20 years or more"): 111,
                ("Released", "Between 8 and 9 years"): 96,
                ("Released", "Between 9 and 10 years"): 65,
                ("Detained", "Up to 1 year"): 5342,
                ("Detained", "Not Known"): 2179,
                ("Detained", "20 years or more"): 210,
                ("Detained", "Between 1 and 2 years"): 160,
                ("Detained", "Between 10 and 15 years"): 135,
                ("Detained", "Between 2 and 3 years"): 120,
                ("Detained", "Between 15 and 20 years"): 107,
                ("Detained", "Between 3 and 4 years"): 61,
                ("Detained", "Between 5 and 6 years"): 49,
                ("Detained", "Between 4 and 5 years"): 43,
                ("Detained", "Between 6 and 7 years"): 39,
                ("Detained", "Between 7 and 8 years"): 34,
                ("Detained", "Between 8 and 9 years"): 29,
                ("Detained", "Between 9 and 10 years"): 25,
                ("Not Known", "Up to 1 year"): 7,
                ("Not Known", "Between 1 and 2 years"): 6,
                ("Not Known", "Not Known"): 1,
                ("Not Known", "Between 4 and 5 years"): 1,
            }
        }
    ),
    Dataset(
        filename="2025-02-25_BordrePatrolArrests_ChildFamilyGroup-ArrestMethod-Gender.hdf",
        axes=["Child/Family Group", "Arrest Method", "Gender"],
        axes_order=[0, 1, 2],
        data={
            "Male": {
                ("Other", "Patrol Border"): 2267403,
                ("Other", "Title 42"): 1475118,
                ("Other", "Patrol Interior"): 123271,
                ("Other", "Other Agency (turned over to BP)"): 88309,
                ("Other", "Traffic Check"): 79471,
                ("Other", "Transportation Check"): 8764,
                ("Other", "Anti-Smuggling"): 8400,
                ("Other", "Other Task Force"): 2195,
                ("Other", "CAP Local Incarceration"): 1902,
                ("Other", "Other efforts"): 1819,
                ("Other", "Boat Patrol"): 823,
                ("Other", "CAP Federal Incarceration"): 402,
                ("Other", "Located"): 272,
                ("Other", "Law Enforcement Agency Response"): 123,
                ("Other", "Inspections"): 55,
                ("Other", "Non-Custodial Arrest"): 47,
                ("Other", "CAP State Incarceration"): 43,
                ("Other", "Crewman/Stowaway"): 33,
                ("Other", "Worksite Enforcement"): 33,
                ("Other", "Organized Crime Drug Enforcement"): 22,
                ("Other", "Criminal Alien Program"): 9,
                ("Other", "287(g) Program"): 4,
                ("Other", "Unknown"): 4,
                ("Unknown", "Patrol Border"): 1384846,
                ("Unknown", "Other Agency (turned over to BP)"): 88830,
                ("Unknown", "Traffic Check"): 83946,
                ("Unknown", "Patrol Interior"): 40628,
                ("Unknown", "Transportation Check"): 26651,
                ("Unknown", "CAP Local Incarceration"): 11541,
                ("Unknown", "Anti-Smuggling"): 9282,
                ("Unknown", "Other efforts"): 2216,
                ("Unknown", "CAP Federal Incarceration"): 791,
                ("Unknown", "Boat Patrol"): 788,
                ("Unknown", "Other Task Force"): 542,
                ("Unknown", "CAP State Incarceration"): 268,
                ("Unknown", "Law Enforcement Agency Response"): 91,
                ("Unknown", "Located"): 83,
                ("Unknown", "Inspections"): 52,
                ("Unknown", "Criminal Alien Program"): 46,
                ("Unknown", "Organized Crime Drug Enforcement"): 41,
                ("Unknown", "Crewman/Stowaway"): 39,
                ("Unknown", "287(g) Program"): 7,
                ("Child (Unaccompanied)", "Patrol Border"): 516657,
                ("Child (Unaccompanied)", "Patrol Interior"): 13987,
                ("Child (Unaccompanied)", "Title 42"): 13301,
                ("Child (Unaccompanied)", "Other Agency (turned over to BP)"): 8676,
                ("Child (Unaccompanied)", "Traffic Check"): 5780,
                ("Child (Unaccompanied)", "Transportation Check"): 731,
                ("Child (Unaccompanied)", "Anti-Smuggling"): 725,
                ("Child (Unaccompanied)", "CAP Local Incarceration"): 374,
                ("Child (Unaccompanied)", "Other efforts"): 175,
                ("Child (Unaccompanied)", "Boat Patrol"): 90,
                ("Child (Unaccompanied)", "Other Task Force"): 42,
                ("Child (Unaccompanied)", "Inspections"): 23,
                ("Child (Unaccompanied)", "Located"): 17,
                ("Child (Unaccompanied)", "Law Enforcement Agency Response"): 8,
                ("Child (Unaccompanied)", "CAP Federal Incarceration"): 6,
                ("Child (Unaccompanied)", "CAP State Incarceration"): 2,
                ("Child (Unaccompanied)", "Non-Custodial Arrest"): 2,
                ("Child (Unaccompanied)", "Criminal Alien Program"): 2,
                ("Child (Unaccompanied)", "Crewman/Stowaway"): 1,
                ("Child (Unaccompanied)", "Worksite Enforcement"): 1,
                ("Family Unit (child)", "Patrol Border"): 474626,
                ("Family Unit (child)", "Title 42"): 58914,
                ("Family Unit (child)", "Other Agency (turned over to BP)"): 4014,
                ("Family Unit (child)", "Traffic Check"): 3824,
                ("Family Unit (child)", "Patrol Interior"): 2344,
                ("Family Unit (child)", "Transportation Check"): 496,
                ("Family Unit (child)", "Anti-Smuggling"): 441,
                ("Family Unit (child)", "Inspections"): 262,
                ("Family Unit (child)", "CAP Local Incarceration"): 170,
                ("Family Unit (child)", "Other efforts"): 158,
                ("Family Unit (child)", "Boat Patrol"): 154,
                ("Family Unit (child)", "Non-Custodial Arrest"): 141,
                ("Family Unit (child)", "Other Task Force"): 25,
                ("Family Unit (child)", "Located"): 4,
                ("Family Unit (child)", "Law Enforcement Agency Response"): 3,
                ("Family Unit (child)", "Criminal Alien Program"): 3,
                ("Family Unit (child)", "CAP State Incarceration"): 2,
                ("Family Unit (child)", "Worksite Enforcement"): 1,
                ("Family Unit (adult)", "Patrol Border"): 287263,
                ("Family Unit (adult)", "Title 42"): 33362,
                ("Family Unit (adult)", "Traffic Check"): 424,
                ("Family Unit (adult)", "Patrol Interior"): 415,
                ("Family Unit (adult)", "Other Agency (turned over to BP)"): 406,
                ("Family Unit (adult)", "Inspections"): 164,
                ("Family Unit (adult)", "Non-Custodial Arrest"): 130,
                ("Family Unit (adult)", "Other efforts"): 86,
                ("Family Unit (adult)", "Boat Patrol"): 71,
                ("Family Unit (adult)", "Transportation Check"): 47,
                ("Family Unit (adult)", "Anti-Smuggling"): 43,
                ("Family Unit (adult)", "CAP Local Incarceration"): 38,
                ("Family Unit (adult)", "Other Task Force"): 6,
                ("Family Unit (adult)", "Located"): 3,
                ("Family Unit (adult)", "Law Enforcement Agency Response"): 2,
                ("Family Unit (adult)", "Criminal Alien Program"): 2,
                ("Family Unit (adult)", "Organized Crime Drug Enforcement"): 1,
            },
            "Female": {
                ("Other", "Patrol Border"): 500545,
                ("Other", "Title 42"): 269257,
                ("Other", "Patrol Interior"): 24067,
                ("Other", "Traffic Check"): 18033,
                ("Other", "Other Agency (turned over to BP)"): 13251,
                ("Other", "Transportation Check"): 1796,
                ("Other", "Anti-Smuggling"): 1509,
                ("Other", "Boat Patrol"): 424,
                ("Other", "Other Task Force"): 293,
                ("Other", "Other efforts"): 235,
                ("Other", "CAP Local Incarceration"): 122,
                ("Other", "Inspections"): 28,
                ("Other", "Located"): 24,
                ("Other", "CAP Federal Incarceration"): 16,
                ("Other", "Non-Custodial Arrest"): 15,
                ("Other", "Worksite Enforcement"): 11,
                ("Other", "Organized Crime Drug Enforcement"): 6,
                ("Other", "Law Enforcement Agency Response"): 6,
                ("Other", "Crewman/Stowaway"): 5,
                ("Other", "CAP State Incarceration"): 4,
                ("Other", "287(g) Program"): 1,
                ("Other", "Criminal Alien Program"): 1,
                ("Unknown", "Patrol Border"): 231058,
                ("Unknown", "Traffic Check"): 16858,
                ("Unknown", "Other Agency (turned over to BP)"): 12533,
                ("Unknown", "Patrol Interior"): 9851,
                ("Unknown", "Transportation Check"): 4488,
                ("Unknown", "Anti-Smuggling"): 1550,
                ("Unknown", "CAP Local Incarceration"): 1191,
                ("Unknown", "Boat Patrol"): 401,
                ("Unknown", "Other efforts"): 371,
                ("Unknown", "Other Task Force"): 61,
                ("Unknown", "CAP Federal Incarceration"): 56,
                ("Unknown", "Law Enforcement Agency Response"): 19,
                ("Unknown", "Located"): 12,
                ("Unknown", "Inspections"): 9,
                ("Unknown", "Organized Crime Drug Enforcement"): 5,
                ("Unknown", "Criminal Alien Program"): 4,
                ("Unknown", "Crewman/Stowaway"): 3,
                ("Unknown", "CAP State Incarceration"): 2,
                ("Child (Unaccompanied)", "Patrol Border"): 192812,
                ("Child (Unaccompanied)", "Patrol Interior"): 3462,
                ("Child (Unaccompanied)", "Other Agency (turned over to BP)"): 2323,
                ("Child (Unaccompanied)", "Title 42"): 2305,
                ("Child (Unaccompanied)", "Traffic Check"): 2088,
                ("Child (Unaccompanied)", "Transportation Check"): 215,
                ("Child (Unaccompanied)", "Anti-Smuggling"): 144,
                ("Child (Unaccompanied)", "CAP Local Incarceration"): 60,
                ("Child (Unaccompanied)", "Boat Patrol"): 58,
                ("Child (Unaccompanied)", "Other efforts"): 33,
                ("Child (Unaccompanied)", "Inspections"): 14,
                ("Child (Unaccompanied)", "Other Task Force"): 4,
                ("Child (Unaccompanied)", "Located"): 4,
                ("Family Unit (child)", "Patrol Border"): 373617,
                ("Family Unit (child)", "Title 42"): 51386,
                ("Family Unit (child)", "Traffic Check"): 2317,
                ("Family Unit (child)", "Other Agency (turned over to BP)"): 2094,
                ("Family Unit (child)", "Patrol Interior"): 1407,
                ("Family Unit (child)", "Transportation Check"): 335,
                ("Family Unit (child)", "Inspections"): 233,
                ("Family Unit (child)", "Anti-Smuggling"): 197,
                ("Family Unit (child)", "Non-Custodial Arrest"): 140,
                ("Family Unit (child)", "Boat Patrol"): 121,
                ("Family Unit (child)", "Other efforts"): 98,
                ("Family Unit (child)", "CAP Local Incarceration"): 54,
                ("Family Unit (child)", "Other Task Force"): 12,
                ("Family Unit (child)", "Located"): 5,
                ("Family Unit (child)", "Law Enforcement Agency Response"): 4,
                ("Family Unit (adult)", "Patrol Border"): 446807,
                ("Family Unit (adult)", "Title 42"): 72779,
                ("Family Unit (adult)", "Other Agency (turned over to BP)"): 1137,
                ("Family Unit (adult)", "Traffic Check"): 1061,
                ("Family Unit (adult)", "Patrol Interior"): 789,
                ("Family Unit (adult)", "Inspections"): 276,
                ("Family Unit (adult)", "Non-Custodial Arrest"): 193,
                ("Family Unit (adult)", "Transportation Check"): 103,
                ("Family Unit (adult)", "Boat Patrol"): 89,
                ("Family Unit (adult)", "Anti-Smuggling"): 62,
                ("Family Unit (adult)", "Other efforts"): 58,
                ("Family Unit (adult)", "CAP Local Incarceration"): 53,
                ("Family Unit (adult)", "Located"): 6,
                ("Family Unit (adult)", "Other Task Force"): 6,
                ("Family Unit (adult)", "Law Enforcement Agency Response"): 1,
                ("Family Unit (adult)", "Criminal Alien Program"): 1,
            },
            "Unknown": {
                ("Other", "Title 42"): 44,
                ("Unknown", "Patrol Border"): 39,
                ("Unknown", "Transportation Check"): 2,
                ("Unknown", "Traffic Check"): 2,
                ("Family Unit (child)", "Patrol Border"): 1,
                ("Family Unit (child)", "Title 42"): 1,
                ("Family Unit (adult)", "Title 42"): 4
            }
        }
    ),
    Dataset(
        filename="2025-02-25_WomenWithChildren_Outcome-FiscalYearCaseBegan-Represented.hdf",
        axes=["Outcome", "Fiscal Year Case Began", "Represented"],
        axes_order=[0, 1, 2],
        data={
            "Represented": {
                ("Grant Relief", "2015"): 2506,
                ("Grant Relief", "2014"): 2161,
                ("Grant Relief", "2016"): 1820,
                ("Grant Relief", "2017"): 95,
                ("Grant Relief", "2013"): 6,
                ("Grant Relief", "2012"): 2,
                ("Grant Relief", "2005"): 1,
                ("Other Closure", "2014"): 952,
                ("Other Closure", "2015"): 712,
                ("Other Closure", "2016"): 574,
                ("Other Closure", "2017"): 29,
                ("Other Closure", "2013"): 12,
                ("Other Closure", "2011"): 1,
                ("Other Closure", "2012"): 1,
                ("Pending", "2016"): 38991,
                ("Pending", "2015"): 16905,
                ("Pending", "2017"): 9679,
                ("Pending", "2014"): 9077,
                ("Pending", "2013"): 67,
                ("Pending", "2005"): 5,
                ("Pending", "2011"): 5,
                ("Pending", "2012"): 2,
                ("Pending", "2010"): 1,
                ("Pending", "2009"): 1,
                ("Pending", "2008"): 1,
                ("Pending", "2006"): 1,
                ("Pros. Discretion", "2014"): 414,
                ("Pros. Discretion", "2015"): 229,
                ("Pros. Discretion", "2016"): 56,
                ("Pros. Discretion", "2013"): 29,
                ("Pros. Discretion", "2012"): 4,
                ("Removal Order", "2016"): 6450,
                ("Removal Order", "2015"): 6007,
                ("Removal Order", "2014"): 5098,
                ("Removal Order", "2017"): 497,
                ("Removal Order", "2013"): 8,
                ("Removal Order", "2007"): 7,
                ("Removal Order", "2006"): 4,
                ("Removal Order", "2012"): 4,
                ("Removal Order", "2010"): 3,
                ("Removal Order", "2011"): 2,
                ("Removal Order", "2009"): 2,
                ("Removal Order", "2008"): 2,
                ("Removal Order", "2005"): 1,
                ("Terminate Proceedings", "2014"): 657,
                ("Terminate Proceedings", "2015"): 562,
                ("Terminate Proceedings", "2016"): 282,
                ("Terminate Proceedings", "2017"): 21,
                ("Terminate Proceedings", "2013"): 2,
                ("Terminate Proceedings", "2009"): 1,
                ("Voluntary Departure", "2016"): 568,
                ("Voluntary Departure", "2015"): 555,
                ("Voluntary Departure", "2014"): 462,
                ("Voluntary Departure", "2017"): 54,
                ("Voluntary Departure", "2007"): 6,
                ("Voluntary Departure", "2012"): 6,
                ("Voluntary Departure", "2006"): 5,
                ("Voluntary Departure", "2008"): 5,
                ("Voluntary Departure", "2010"): 4,
                ("Voluntary Departure", "2013"): 3,
                ("Voluntary Departure", "2011"): 3,
                ("Voluntary Departure", "2005"): 3,
                ("Voluntary Departure", "2009"): 1,
            },
            "Not Represented": {
                ("Grant Relief", "2015"): 93,
                ("Grant Relief", "2016"): 88,
                ("Grant Relief", "2014"): 68,
                ("Grant Relief", "2017"): 7,
                ("Grant Relief", "2013"): 1,
                ("Other Closure", "2014"): 213,
                ("Other Closure", "2015"): 165,
                ("Other Closure", "2016"): 120,
                ("Other Closure", "2017"): 32,
                ("Other Closure", "2013"): 3,
                ("Other Closure", "2007"): 1,
                ("Other Closure", "2012"): 1,
                ("Pending", "2016"): 9354,
                ("Pending", "2017"): 4081,
                ("Pending", "2015"): 2840,
                ("Pending", "2014"): 1129,
                ("Pending", "2013"): 10,
                ("Pending", "2012"): 3,
                ("Pending", "2006"): 1,
                ("Pending", "2007"): 1,
                ("Pros. Discretion", "2014"): 28,
                ("Pros. Discretion", "2015"): 21,
                ("Pros. Discretion", "2016"): 8,
                ("Pros. Discretion", "2013"): 6,
                ("Pros. Discretion", "2011"): 1,
                ("Removal Order", "2016"): 13713,
                ("Removal Order", "2014"): 12410,
                ("Removal Order", "2015"): 11180,
                ("Removal Order", "2017"): 3042,
                ("Removal Order", "2005"): 204,
                ("Removal Order", "2006"): 85,
                ("Removal Order", "2013"): 57,
                ("Removal Order", "2007"): 38,
                ("Removal Order", "2010"): 29,
                ("Removal Order", "2008"): 25,
                ("Removal Order", "2009"): 23,
                ("Removal Order", "2011"): 18,
                ("Removal Order", "2012"): 11,
                ("Terminate Proceedings", "2015"): 317,
                ("Terminate Proceedings", "2016"): 291,
                ("Terminate Proceedings", "2014"): 102,
                ("Terminate Proceedings", "2017"): 41,
                ("Terminate Proceedings", "2013"): 5,
                ("Terminate Proceedings", "2005"): 1,
                ("Voluntary Departure", "2015"): 622,
                ("Voluntary Departure", "2016"): 593,
                ("Voluntary Departure", "2014"): 357,
                ("Voluntary Departure", "2017"): 129,
                ("Voluntary Departure", "2011"): 4,
                ("Voluntary Departure", "2010"): 4,
                ("Voluntary Departure", "2009"): 4,
                ("Voluntary Departure", "2006"): 4,
                ("Voluntary Departure", "2013"): 3,
                ("Voluntary Departure", "2007"): 3,
                ("Voluntary Departure", "2005"): 2,
            }
        }
    )
]

for d in datasets:
    create_raw_df(d)
    clean_dataset(d)
    save_dataset(d)
	

